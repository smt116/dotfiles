#!/usr/bin/env sh

arguments=$@

if [[ "${arguments[@]}" =~ "--no-window-system" ]]; then
  emacs $@
else
  if [ -z $(emacsclient -e '(emacs-pid)' 2> /dev/null) ]; then
    launchctl start homebrew.mxcl.emacs
  fi

  sleep 0.5

  if ps x | grep emacsclient | grep -v grep; then
    nohup emacsclient "$@" > /dev/null 2>&1 &
  else
    nohup emacsclient --create-frame "$@" > /dev/null 2>&1 &
  fi
fi
